<html>
	<head>
		<title>Polygon</title>
		<style>canvas { width: 100%; height: 100% }</style>
	</head>
	<body>
		<!-- Laddar in three.js -->
		<script src="https://rawgithub.com/mrdoob/three.js/master/build/three.js"></script>

		<!-- Laddar in tween-biblioteket -->
		<script type='text/javascript' src='./js/tween.min.js'></script>
		<!-- Laddar in styrningen -->
		<script src="./js/FirstPersonControls.js"></script>
		<!-- Laddar in så det enkelt går att spela musik -->
		<script src="./js/AudioObject.js"></script>

		<script>
			var camera, scene, renderer, planets, controls, clock, cube;
	  
	  	//Anropar funktioner för att bygga världen samt Three.js-inställningnarna, för att sedan rendera
	  	function setup() {
		    setupThreeJS();
		    setupWorld();
		    setupTween();	
		}; 

		function animation(){
			requestAnimationFrame(function animate() {
		     	for ( var i = 0, l = objects.length; i < l; i ++ ) {

					var object = objects[i];

					object.rotation.x += Math.random()*0.01;
					object.rotation.y += 0.01;
				}

				
			var timer = 0.0001 * Date.now();

	     	particleLight.position.x = Math.sin( timer * 7 ) * 1000;
			particleLight.position.y = Math.cos( timer * 5 ) * 1000;
			particleLight.position.z = Math.cos( timer * 3 ) * 1000;

			pointLight.position.x = particleLight.position.x;
			pointLight.position.y = particleLight.position.y;
			pointLight.position.z = particleLight.position.z;

			render();
			update();

     		requestAnimationFrame(animate);
			});
	 	}

	 	function render() {
	 		renderer.render(scene, camera);
	 	}

	 	function update(){
	 		controls.update(clock.getDelta());
     		TWEEN.update();
	 	}

	  	 //Sätter inställningnarna för three.js
	   	function setupThreeJS() {
			scene = new THREE.Scene();
			camera = new THREE.PerspectiveCamera(45, window.innerWidth /
			window.innerHeight, 1, 10000);
			camera.position.y = 10;
 			camera.position.z = 100;

			//Renderar i WebGL om webläsaren stödjer det
			if (window.WebGLRenderingContext)
				renderer = new THREE.WebGLRenderer();
			else
				renderer = new THREE.CanvasRenderer();
			renderer.setSize(window.innerWidth, window.innerHeight);
			document.body.appendChild(renderer.domElement);

			//Används för styrningen, som i detta fall är FirstPersonControls
			clock = new THREE.Clock();
			controls = new THREE.FirstPersonControls(camera);
			controls.movementSpeed = 100;
			controls.lookSpeed = 0.1;
		}

	   //Definerar världen och objekt som finns i den
	   function setupWorld() {

	   		//Skybox
	   		//Laddar in sex bilder och applicerar som textur på 5000x5000x5000-kub
	   		var imagePrefix = "skybox/space-";
			var directions  = ["xpos", "xneg", "ypos", "yneg", "zpos", "zneg"];
			var imageSuffix = ".jpg";
			var skyGeometry = new THREE.BoxGeometry( 5000, 5000, 5000 );	
			 
			var skyMaterialArray = [];
			for (var i = 0; i < 6; i++)
				skyMaterialArray.push( new THREE.MeshBasicMaterial({
					map: THREE.ImageUtils.loadTexture( imagePrefix + directions[i] + imageSuffix ),
					side: THREE.BackSide
				}));
			var skyMaterial = new THREE.MeshFaceMaterial( skyMaterialArray );
			var skyBox = new THREE.Mesh( skyGeometry, skyMaterial );
			scene.add( skyBox );

      
			var materials = [];
			materials.push(new THREE.MeshLambertMaterial({color: Math.random() * 0xffffff, shading: THREE.FlatShading}));
			materials.push(new THREE.MeshLambertMaterial({color: Math.random() * 0xffffff, shading: THREE.FlatShading}));
			materials.push(new THREE.MeshBasicMaterial({color: Math.random() * 0xffffff, wireframe: true}));
			materials.push(new THREE.MeshBasicMaterial({color: Math.random() * 0xffffff, wireframe: true}));
			materials.push(new THREE.MeshLambertMaterial({color: Math.random() * 0xffffff, transparent: true, shading: THREE.FlatShading}));
			materials.push( new THREE.MeshPhongMaterial( { ambient: 0x030303, color: 0xdddddd, specular: 0x009900, shininess: 30, shading: THREE.FlatShading } ) );
			materials.push(new THREE.MeshLambertMaterial({color: Math.random() * 0xffffff, shading: THREE.FlatShading}));
			materials.push(new THREE.MeshLambertMaterial({color: Math.random() * 0xffffff, shading: THREE.FlatShading}));
			materials.push(new THREE.MeshLambertMaterial({color: Math.random() * 0xffffff, shading: THREE.FlatShading}));
			materials.push(new THREE.MeshLambertMaterial({color: Math.random() * 0xffffff, shading: THREE.FlatShading}));
			materials.push(new THREE.MeshLambertMaterial({color: Math.random() * 0xffffff, shading: THREE.FlatShading}));


			objects = [];

		     for (var i = 0; i < 1000; i++) {
			    var planetRadius = Math.ceil((Math.random() * 80));
                var planetGeometry = new THREE.IcosahedronGeometry(planetRadius, 1);
                var planetMaterial = materials[Math.ceil(Math.random()*(materials.length-1))];
                var planet = new THREE.Mesh(planetGeometry, planetMaterial);

				planet.position.y = Math.floor(Math.random() * 200 - 100) * 15;
				planet.position.z = Math.floor(Math.random() * 200 - 100) * 15;
				planet.position.x = Math.floor(Math.random() * 200 - 100) * 10;

				planet.rotation.x = Math.random() * 200 - 100;
				planet.rotation.y = Math.random() * 200 - 100;
				planet.rotation.z = Math.random() * 200 - 100;
				
				objects.push(planet);
				
				scene.add(planet);
			}


			//Ett kub-objekt för att examplifiera animationen
			var cube_geometry = new THREE.BoxGeometry(10, 10, 10);
			var material = new THREE.MeshBasicMaterial( {color: 0x00ff00} );
			cube = new THREE.Mesh( cube_geometry, material );
			scene.add(cube);

			//Sätter igång och loopar musiken
			//var music = new THREE.AudioObject('mys.mp3', 0, 1, true);
  			//scene.add(music);

  			//------LJUS------

  			var ambiColor = "#0c0c0c";
   			var ambientLight = new THREE.AmbientLight(ambiColor);

   			scene.add(ambientLight);

  			var directionalLight = new THREE.DirectionalLight( 0xffffff, 0.125 );

			directionalLight.position.x = Math.random() * 400;
			directionalLight.position.y = Math.random() * 400;
			directionalLight.position.z = Math.random() * 400;

			directionalLight.position.normalize();

			scene.add( directionalLight );

			//stjärna som upplevs lysa
			particleLight = new THREE.Mesh( new THREE.SphereGeometry( 4, 8, 8 ), new THREE.MeshBasicMaterial( { color: 0xffffff } ) );
			scene.add( particleLight );

			//ljuset åt stjärnan
			pointLight = new THREE.PointLight( 0xffffff, 1 );
			scene.add( pointLight );
		}

		//Anävnder ramverket Tween för att animera
		function setupTween()
		{
			var update	= function(){
				cube.position.x = current.x;
			}
			var current	= { x: 0 };

			//Ta bort eventuella äldre tweens
			TWEEN.removeAll();

			//Sätter hur animationen ska se ut.
			var easing	= TWEEN.Easing.Sinusoidal.InOut;

			//Animation åt ena hållet
			var tweenHead	= new TWEEN.Tween(current)
			.to({x: 100}, 2000)
			.easing(easing)
			.onUpdate(update);

			//Animation åt andra hållet
			var tweenBack	= new TWEEN.Tween(current)
			.to({x: -100}, 2000)
			.easing(easing)
			.onUpdate(update);

			//Kedjar de båda animationerna
			tweenHead.chain(tweenBack);
			tweenBack.chain(tweenHead);

			tweenHead.start();
		}


		setup();
		animation();

		</script>
	</body>
</html>